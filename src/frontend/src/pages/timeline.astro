---
import BaseLayout from '../layouts/BaseLayout.astro';
import TimelineContainer from '../components/TimelineContainer.jsx';

// Fetch timeline data from Express API server
let timeline = [];
try {
  // Use the API service URL (from compose.yaml environment)
  const apiUrl = process.env.BACKEND_URL || 'http://api:3000';
  const response = await fetch(`${apiUrl}/api/timeline`);
  
  if (response.ok) {
    timeline = await response.json();
    console.log(`Fetched ${timeline.length} timeline events from API`);
  } else {
    console.error('Failed to fetch timeline:', response.status, response.statusText);
  }
} catch (error) {
  console.error('Error fetching timeline:', error);
}

// Extract unique satellites
const satellites = Array.from(new Set(timeline.map(e => e.satellite_name)));
---

<BaseLayout title="Mission Planner - Timeline" activePage="timeline">
  <div class="space-y-8">
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-8">
      <h1 class="text-3xl font-bold text-astro-dark mb-4">Mission Timeline</h1>
      <p class="text-astro-gray mb-6">
        View and manage the complete mission timeline with key milestones and events.
      </p>
      <div class="mb-4">
        <TimelineContainer 
          client:load 
          events={timeline} 
          satellites={satellites} 
        />
      </div>
    </div>
  </div>
</BaseLayout>