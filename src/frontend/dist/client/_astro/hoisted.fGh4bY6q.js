import"./hoisted.ubEzurhk.js";const d="http://localhost:3000";async function y(){try{const e=await fetch(`${d}/health`,{method:"GET",headers:{"Content-Type":"application/json"}});if(e.ok){const t=await e.json();return a("api","operational",`Online (${t.timestamp.split("T")[1].split(".")[0]})`),!0}else return a("api","error",`HTTP ${e.status}`),!1}catch{return a("api","error","Connection failed"),!1}}async function f(){try{const e=await fetch(`${d}/db-test`,{method:"GET",headers:window.getAuthHeaders?window.getAuthHeaders():{"Content-Type":"application/json"}});if(e.ok){const t=await e.json();return a("db","operational","Connected"),!0}else{const t=await e.json();return a("db","error",t.error||"Connection failed"),!1}}catch{return a("db","error","Connection failed"),!1}}async function w(){try{const e=await fetch(`${d}/api/satellites`,{method:"GET",headers:window.getAuthHeaders?window.getAuthHeaders():{"Content-Type":"application/json"}});if(e.ok){const t=await e.json();return a("satellites","operational",`${t.length} satellites tracked`),!0}else return a("satellites","warning","Data access limited"),!1}catch{return a("satellites","error","Service unavailable"),!1}}async function E(){try{const e=await fetch(`${d}/api/locations/all`,{method:"GET",headers:window.getAuthHeaders?window.getAuthHeaders():{"Content-Type":"application/json"}});if(e.ok){const t=await e.json(),s=t.satellites?t.satellites.length:0,n=t.ground_stations?t.ground_stations.length:0;return a("location","operational",`${s} sats, ${n} ground stations`),!0}else return a("location","warning","Limited functionality"),!1}catch{return a("location","error","Service unavailable"),!1}}function a(e,t,s){const n=document.getElementById(`${e}Indicator`),r=document.getElementById(`${e}StatusText`),o=document.getElementById(`${e}Status`);switch(o.className="flex items-center justify-between p-4 rounded-lg",n.className="w-3 h-3 rounded-full mr-3",t){case"operational":o.classList.add("bg-green-50","border","border-green-200"),n.classList.add("bg-green-500"),r.className="text-sm text-green-700";break;case"warning":o.classList.add("bg-yellow-50","border","border-yellow-200"),n.classList.add("bg-yellow-500"),r.className="text-sm text-yellow-700";break;case"error":o.classList.add("bg-red-50","border","border-red-200"),n.classList.add("bg-red-500"),r.className="text-sm text-red-700";break;default:o.classList.add("bg-gray-50","border","border-gray-300"),n.classList.add("bg-gray-500"),r.className="text-sm text-gray-700"}r.textContent=s}function p(e){const t=e.filter(h=>h).length,s=e.length,n=Math.round(t/s*100),r=document.getElementById("overallStatus"),o=document.getElementById("overallStatusText"),g=document.getElementById("lastChecked");r.className="p-4 border rounded-lg",n>=75?(r.classList.add("bg-green-50","border-green-200"),o.className="text-sm text-green-700",o.textContent=`Healthy (${t}/${s} services)`):n>=50?(r.classList.add("bg-yellow-50","border-yellow-200"),o.className="text-sm text-yellow-700",o.textContent=`Degraded (${t}/${s} services)`):(r.classList.add("bg-red-50","border-red-200"),o.className="text-sm text-red-700",o.textContent=`Critical (${t}/${s} services)`),g.textContent=`Last checked: ${new Date().toLocaleTimeString()}`}async function u(){try{const e=await fetch(`${d}/api/users/stats`,{method:"GET",headers:window.getAuthHeaders?window.getAuthHeaders():{"Content-Type":"application/json"}});if(e.ok){const t=await e.json();document.getElementById("totalUsers").textContent=t.total_users||0,document.getElementById("adminUsers").textContent=t.admin_users||0}else document.getElementById("totalUsers").textContent="Error",document.getElementById("adminUsers").textContent="Error"}catch(e){console.error("Error loading user stats:",e),document.getElementById("totalUsers").textContent="Error",document.getElementById("adminUsers").textContent="Error"}}function C(){document.getElementById("userModal").classList.remove("hidden"),document.getElementById("createUserForm").reset(),m()}function c(){document.getElementById("userModal").classList.add("hidden")}function i(e){const t=document.getElementById("userModalError"),s=document.getElementById("userModalSuccess");t.textContent=e,t.classList.remove("hidden"),s.classList.add("hidden")}function b(e){const t=document.getElementById("userModalSuccess"),s=document.getElementById("userModalError");t.textContent=e,t.classList.remove("hidden"),s.classList.add("hidden")}function m(){document.getElementById("userModalError").classList.add("hidden"),document.getElementById("userModalSuccess").classList.add("hidden")}async function x(e){try{const t=await fetch(`${d}/api/auth/register`,{method:"POST",headers:window.getAuthHeaders?window.getAuthHeaders():{"Content-Type":"application/json"},body:JSON.stringify(e)}),s=await t.json();return t.ok?(b("User created successfully!"),setTimeout(()=>{u(),c()},2e3),!0):(i(s.error||"Failed to create user"),!1)}catch(t){return i("Network error. Please try again."),console.error("Create user error:",t),!1}}async function l(){const e=document.getElementById("refreshStatus");e.textContent="Checking...",e.disabled=!0,["api","db","satellites","location"].forEach(t=>{a(t,"checking","Checking...")});try{const t=await Promise.all([y(),f(),w(),E()]);p(t)}catch(t){console.error("Error running system checks:",t),document.getElementById("overallStatusText").textContent="Check failed"}finally{e.textContent="Refresh",e.disabled=!1}}document.addEventListener("DOMContentLoaded",function(){if(window.hasRole&&!window.hasRole("admin")){document.getElementById("overallStatusText").textContent="Admin access required";return}l(),u(),document.getElementById("refreshStatus").addEventListener("click",l),document.getElementById("createUserBtn").addEventListener("click",C),document.getElementById("closeModal").addEventListener("click",c),document.getElementById("cancelCreate").addEventListener("click",c),document.getElementById("createUserForm").addEventListener("submit",async e=>{e.preventDefault(),m();const t=document.getElementById("submitCreateUser"),s=t.textContent;t.textContent="Creating...",t.disabled=!0;const n=new FormData(e.target),r={username:n.get("username"),email:n.get("email"),password:n.get("password"),role:n.get("role")};await x(r),t.textContent=s,t.disabled=!1}),document.getElementById("userModal").addEventListener("click",e=>{e.target.id==="userModal"&&c()}),setInterval(l,3e4)});
